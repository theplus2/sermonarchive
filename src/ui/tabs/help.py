import streamlit as st

def render_help():
    st.title("❓ 도움말 (User Manual)")
    st.caption("설교자의 서재 v5.2.9 사용 가이드")
    
    # 아이콘 및 마크다운 제거하여 깔끔하게 표시
    # Stremlit의 st.tabs는 마크다운을 일부 지원하지만, 때로 기호가 깨질 수 있음.
    tab0, tab1, tab2, tab3, tab4 = st.tabs([
        "👨‍💻 개발자 소개", 
        "🚀 시작하기 (필독)", 
        "🌟 기능 상세 가이드", 
        "❓ 자주 묻는 질문 (FAQ)", 
        "📢 업데이트 로그"
    ])
    
    # 개발자 소개 탭
    with tab0:
        st.markdown("""
        ### 👋 안녕하세요. 윤영천 목사입니다.
        
        코딩을 전혀 몰라도 프로그램을 만들 수 있는 시대가 되었습니다.
        
        ---
        
        #### 📖 <목사님도 코딩 하실 수 있어요!>
        **- 코딩 1도 모르는 목사가 알려주는 바이브 코딩 -**
        
        이라는 프로젝트로 여러가지 프로그램을 개발하고,  
        목회에 도움이 되는 AI 활용법을 친절하고 상세하게 알려드릴 계획입니다.
        
        ---
        
        #### ✝️ 설교자의 서재를 만들게 된 이유
        
        이번 **'설교자의 서재'** 프로그램은  
        설교원고를 **HWP 파일**이나 **DOCX 파일**로 작업하시던 목사님들의 편의를 위해  
        이 프로그램을 개발하게 되었습니다.
        
        설교 원고는 파일로 쌓여가지만, **색인작업과 검색을 매우 불편해 하셨던 저희 아버지**를 생각하면서  
        프로그램을 기획하고 만들게 되었습니다.
        
        ---
        
        #### 🔗 연락처 및 업데이트 안내
        
        기능이 업데이트 될 때마다 확인하시고 다운로드 받으시기 위해서는  
        **제 블로그를 방문**해 주시면 되겠습니다.
        
        📎 **블로그 주소**: [http://blog.naver.com/theplus2](http://blog.naver.com/theplus2)
        
        모든 문의는 **블로그**나 **이메일**로 해주시면 확인하고 답변드리겠습니다.
        
        ---
        
        감사합니다. 🙏
        
        **잠실한빛교회(기성) 청년부 담당 윤영천 목사 드림.**
        
        ---
        
        ### ☕ 따뜻한 후원의 마음
        
        이 프로그램은 누구나 자유롭게 사용할 수 있는 무료 소프트웨어입니다.  
        하지만 개발에는 정말 많은 시간과 노력이 들어갔습니다.  
        프로그램이 마음에 드신다면, 개발자님께 커피 한 잔의 응원을 보내주시는 건 어떨까요?
        
        **후원 계좌: 하나은행 670-910177-84807 (윤영천)**
        """, unsafe_allow_html=True)
    
    # 시작하기 탭
    with tab1:
        st.markdown("""
        ### 🎉 설교자의 서재에 오신 것을 환영합니다!
        
        이 프로그램은 목사님의 컴퓨터에 저장된 <strong>한글(HWP)</strong> 및 <strong>워드(DOCX)</strong> 설교 파일을 자동으로 읽어와서  
        <strong>검색, 통계, 연대기</strong> 기능을 제공하는 설교 원고 관리 프로그램입니다.
        
        ---
        
        ### 📌 1단계: 설교 파일 준비하기
        
        가장 중요한 것은 <strong>"컴퓨터가 알아먹게 이름을 짓는 것"</strong>입니다.
        
        #### ✅ 날짜 인식 규칙 (파일명)
        파일 이름에 날짜가 있어야 <strong>'연대기'</strong> 탭에 표시됩니다.
        
        | 형식 | 예시 | 설명 |
        |------|------|------|
        | 6자리 붙여쓰기 | `230521` | ✨ <strong>가장 추천!</strong> (2023년 5월 21일) |
        | 8자리 붙여쓰기 | `20230521` | 연도 4자리 포함 |
        | 구분자 사용 | `2023-05-21` | 하이픈(-), 점(.), 공백( ) 모두 가능 |
        | 영문자 + 6자리 | `p220703` | 파일명 앞에 영문자 하나 있어도 OK |
        | 연도 띄우기 | `2023 0521` | 연도와 월일 사이 공백 |
        
        #### ✅ 성경 본문 인식 규칙
        본문 내용이나 파일명에 <strong>"성경이름 + 장:절"</strong> 형식이 있어야 통계에 잡힙니다.
        
        | 형식 | 예시 |
        |------|------|
        | 정식 표기 | `마태복음 5:3`, `창세기 1:1` |
        | 약어 표기 | `마 5:3`, `창 1:1` |
        | 장만 표기 | `마태복음 5장`, `창14장` |
        
        ---
        
        ### 📌 2단계: 폴더 연결 및 동기화
        
        1. 왼쪽 메뉴에서 **[⚙️ 설정]**을 클릭하세요.
        2. **[📂 폴더 변경하기]** 버튼을 눌러 설교 파일들이 모여있는 폴더를 선택하세요.
        3. **[🔄 전체 동기화]** 버튼을 누르세요.
        4. 처음 동기화는 파일 수에 따라 몇 분이 걸릴 수 있습니다. ☕ 커피 한 잔 하고 오세요!
        
        ---
        
        ### 📌 3단계: 설교 검색 및 활용
        
        - **✍️ 작업실**: 키워드로 설교를 검색하고, 성경별로 필터링할 수 있습니다.
        - **📅 연대기**: 연도별/월별로 설교 목록을 확인하고 엑셀로 내려받을 수 있습니다.
        - **📊 통계**: 어떤 성경을 많이 설교했는지 히트맵으로 확인할 수 있습니다.
        
        > 💡 **팁**: 왼쪽 사이드바 메뉴를 사용하면 어느 페이지에서든 원하는 메뉴로 바로 이동할 수 있습니다!
        """, unsafe_allow_html=True)
    
    # 기능 상세 가이드 탭
    with tab2:
        st.markdown("""
        ### 🌟 기능별 상세 가이드
        
        ---
        
        #### ✍️ 1. 작업실 (Workspace)
        
        설교 원고를 **검색하고 열람**하는 핵심 기능입니다.
        
        | 기능 | 설명 |
        |------|------|
        | 🔍 **통합 검색** | 제목과 본문을 동시에 검색합니다. 띄어쓰기 주의! |
        | 📖 **성경 필터** | 특정 성경만 선택해서 볼 수 있습니다. 복수 선택 가능! |
        | 📖 **성경순 정렬** | 토글을 켜면 성경 책 순서 → 장 번호 순으로 정렬됩니다. |
        | 🎨 **키워드 하이라이트** | 검색된 단어는 **빨간색 볼드체**로 표시됩니다. |
        | 📄 **페이징** | 결과가 많아도 30개씩 끊어서 빠르게 볼 수 있습니다. |
        
        ---
        
        #### 📅 2. 연대기 (Chronicle)
        
        **언제 어떤 설교를 했는지** 시간순으로 확인할 수 있습니다.
        
        | 기능 | 설명 |
        |------|------|
        | 📆 **연도 필터** | 원하는 연도만 선택해서 볼 수 있습니다. |
        | 📂 **접기/펼치기** | 제목을 클릭하면 본문 전문이 펼쳐집니다. |
        | 📥 **엑셀 내보내기** | 선택한 연도의 설교 목록을 엑셀 파일로 다운로드합니다. |
        
        ---
        
        #### 📊 3. 통계 (Statistics)
        
        나의 **설교 편식 패턴**을 분석해 줍니다.
        
        | 기능 | 설명 |
        |------|------|
        | 🗺️ **성경 히트맵** | 구약(파랑)과 신약(빨강)의 설교 빈도를 색상 농도로 시각화합니다. |
        | 📂 **미분류 명단** | 성경 태그가 인식되지 않은 파일들을 30개씩 페이징하여 보여줍니다. 사유와 미리보기도 제공! |
        | ☁️ **워드 클라우드** | 내 설교에서 가장 자주 등장하는 단어들을 구름 모양으로 시각화합니다. |
        
        ---
        
        #### ⚙️ 4. 설정 (Settings)
        
        프로그램의 **데이터 관리**를 담당합니다.
        
        | 기능 | 설명 |
        |------|------|
        | 📂 **폴더 변경** | 설교 파일이 저장된 폴더를 지정합니다. |
        | 🔄 **동기화** | 파일 변경 사항을 DB에 반영합니다. 파일명 변경/삭제 시 자동 정리됩니다. |
        | 🗑️ **DB 초기화** | 데이터베이스를 완전히 리셋합니다. (주의!) |
        | 📏 **화면 높이 조정** | UI 컨테이너의 높이를 조절합니다. |
        
        ---
        
        #### ❓ 5. 도움말 (Help)
        
        지금 보고 계신 이 페이지입니다! 😊
        """, unsafe_allow_html=True)
    
    # FAQ 탭
    with tab3:
        st.markdown("""
        ### ❓ 자주 묻는 질문 (FAQ)
        
        ---
        
        #### Q. 설교 파일을 수정했는데 반영이 안 돼요.
        
        **A.** 프로그램을 껐다 켜거나 **[⚙️ 설정] > [🔄 동기화 시작]** 버튼을 눌러주세요.  
        동기화를 하면 변경된 파일만 자동으로 업데이트됩니다.
        
        ---
        
        #### Q. 검색했는데 결과가 안 나와요.
        
        **A.** 다음 사항을 확인해 보세요:
        - ✅ 띄어쓰기가 정확한지 확인
        - ✅ 동기화가 최신 상태인지 확인
        - ✅ 성경 필터가 선택되어 있다면 해제해 보기
        
        ---
        
        #### Q. '미분류' 설교가 너무 많아요.
        
        **A.** **[📊 통계]** 메뉴에서 **"📂 미분류 설교 명단 보기"**를 클릭하세요.  
        각 파일별로 왜 미분류되었는지 사유(날짜 없음, 성경 태그 없음)가 표시됩니다.  
        원본 파일의 제목이나 본문 앞부분에 `창세기 1:1` 같은 형식을 추가한 뒤 다시 동기화해주세요.
        
        ---
        
        #### Q. 엑셀 다운로드가 안 돼요.
        
        **A.** 연대기 탭에서 **연도를 하나 이상 선택**하셨는지 확인해 주세요.  
        연도 선택 후 접기를 펼치면 다운로드 버튼이 나타납니다.
        
        ---
        
        #### Q. 파일명을 바꿨는데 이전 파일이 검색돼요.
        
        **A.** v4.9부터는 동기화 시 **폴더에 없는 파일은 자동으로 DB에서 삭제**됩니다.  
        **[⚙️ 설정] > [🔄 동기화 시작]**을 눌러주세요.
        
        ---
        
        #### Q. HWP 파일 내용이 제대로 안 보여요.
        
        **A.** v4.9에서 HWP 텍스트 추출 기능이 대폭 개선되었습니다.  
        DB 초기화 후 다시 동기화하면 개선된 내용을 확인하실 수 있습니다.
        
        ---
        
        #### Q. 성경순 정렬이 제대로 안 돼요.
        
        **A.** v4.9에서 성경 장 번호가 DB에 별도 저장됩니다.  
        **DB 초기화 후 다시 동기화**하면 정확한 장 번호 순서로 정렬됩니다.
        """, unsafe_allow_html=True)
    
    # 업데이트 로그 탭
    with tab4:
        st.markdown("""
        ### 📢 업데이트 로그
        
        ---
        
        #### 🆕 v5.2.9 (2026-01-21) - PDF 지원 및 안정화
        
        **✨ 새로운 기능**
        - 📄 **PDF 파일 포맷 지원**: 설교 원고 중 PDF 파일의 텍스트 추출 및 검색 기능이 추가되었습니다.
        
        **🔧 개선 사항**
        - 🏷️ **버전 정보 통일**: 프로그램 전체의 버전 정보를 v5.2.9로 일괄 업데이트했습니다.
        
        ---
        
        #### 🆕 v5.2.0 (2026-01-20) - macOS 호환성 개선
        
        **🔧 개선 사항**
        - 🍎 **영문 파일명 적용**: macOS에서 한글 파일명으로 인한 실행 오류를 해결하기 위해 앱 파일명을 영문(`SermonArchive`)으로 변경했습니다.
        
        ---
        
        #### 🆕 v5.1.9 (2026-01-20) - macOS ZIP 배포
        
        **🔧 개선 사항**
        - 🍎 **macOS 배포 방식 변경**: DMG 대신 ZIP 파일로 배포합니다. 사용법: 압축 해제 → Applications 폴더로 드래그 → 우클릭 > 열기
        
        ---
        
        #### 🆕 v5.1.8 (2026-01-20) - macOS DMG 빌드 (hdiutil)
        
        **🔧 개선 사항**
        - 🍎 **네이티브 도구 사용**: create-dmg 대신 애플 기본 도구(hdiutil)로 DMG를 생성하여 안정성을 높였습니다.
        
        ---
        
        #### 🆕 v5.1.7 (2026-01-20) - macOS DMG 빌드 안정화
        
        **🔧 개선 사항**
        - 🍎 **DMG 생성 안정화**: create-dmg 명령어 옵션을 간소화하고 펴백 로직을 추가하여 안정적으로 DMG 파일이 생성되도록 개선했습니다.
        
        ---
        
        #### 🆕 v5.1.6 (2026-01-20) - macOS 빌드 긴급 수정
        
        **🔧 개선 사항**
        - 🍎 **빌드 시스템 개선**: 릴리즈 과정에서 발생한 시스템 오류(Bus error)를 해결하기 위해 내부 파일명 처리 로직을 개선했습니다. (영문 파일명 적용)
        
        ---
        
        #### 🆕 v5.1.5 (2026-01-20) - macOS 보안 경고 대응
        
        **🔧 개선 사항**
        - 🍎 **Gatekeeper 대응**: 맥에서 "손상된 파일"이라며 실행되지 않는 문제를 완화하기 위해 앱에 서명(Code Signing)을 추가했습니다.
        
        ---
        
        #### 🆕 v5.1.4 (2026-01-20) - macOS 빌드 안정화
        
        **🔧 개선 사항**
        - 🍎 **아이콘 생성 방식 개선**: macOS 빌드 시 아이콘 포맷 오류를 방지하기 위해 아이콘 생성 프로세스를 개선했습니다.
        
        ---
        
        #### 🆕 v5.1.3 (2026-01-20) - 설치 파일 개선
        
        **🔧 개선 사항**
        - 🍎 **macOS 설치 최적화**: 맥용 설치 파일이 `.dmg` 포맷으로 제공되어 설치가 더욱 쉬워졌습니다.
        - 📦 **파일명 변경**: 다운로드 시 헷갈리지 않게 파일명에 버전 정보가 명시됩니다. (예: `sermon_archive_v5.1.3.dmg`)
        
        ---
        
        #### 🆕 v5.1.2 (2026-01-20) - macOS DMG 지원
        
        **✨ 새로운 기능**
        - 🍎 **macOS 설치 파일(.dmg) 지원**: 맥 사용자를 위한 설치관리자 파일 제공 (기존 .zip 실행 문제 해결)
        
        ---
        
        #### 🆕 v5.1 (2026-01-20) - HWPX 지원 추가
        
        **✨ 새로운 기능**
        - 📄 **HWPX 파일 포맷 지원**: 한글 개방형 문서(.hwpx) 검색 및 텍스트 추출 가능
        
        **🔧 개선 사항**
        - 🔄 **릴리즈 프로세스 최적화**: 버전 관리 및 배포 자동화 스킬 도입
        
        ---
        
        #### 🆕 v4.9.5 (2026-01-17) - 히트맵 UX 대폭 개선
        
        **✨ 새로운 기능**
        - 🔥 **클릭 가능한 히트맵**: 구약/신약 각각 6열 그리드로 정렬, 색상 농도로 빈도 시각화
        - 📋 **구약/신약 별도 목록**: 각 히트맵 옆에 해당 성경의 설교 목록 표시
        - 📄 **페이징 기능**: 30건 이상 시 이전/다음 페이지 버튼으로 탐색
        
        **🔧 개선 사항**
        - ⚡ **DB 동기화 성능 최적화**: ThreadPoolExecutor 병렬 처리로 2~5배 속도 향상
        - 📖 **미리보기 4배 확장**: 설교 본문 미리보기 250자 → 1000자
        - 🎨 **히트맵 호버 애니메이션**: scale(1.18) 효과 및 그림자로 인터랙티브 UX
        - 📏 **버튼 크기 증가**: 70x70px 정사각형으로 가독성 향상
        
        ---
        
        #### 🆕 v4.9 (2026-01-15) - 대규모 기능 개선
        
        **✨ 새로운 기능**
        - 📚 **사이드바 네비게이션**: 어느 페이지에서든 원하는 메뉴로 바로 이동 가능
        - 👨‍💻 **개발자 소개 탭**: 도움말에 개발자 인사말 추가
        - 📖 **성경 장 번호 DB 저장**: 정렬 정확도 대폭 향상
        
        **🔧 개선 사항**
        - 🔄 **동기화 시 삭제된 파일 자동 정리**: 파일명 변경/삭제 시 이전 데이터 자동 제거
        - 📅 **날짜 패턴 확장**: `YYYY MMDD`, `pYYMMDD` 등 더 많은 형식 지원
        - 🏷️ **성경 태깅 정교화**: 오탐지 방지 (한 글자 축약형 단어 경계 체크)
        -  **HWP 텍스트 추출 개선**: 버퍼 제한 회피로 전체 내용 추출
        - 📂 **미분류 목록 개선**: 사유(날짜/태그 없음) 및 미리보기 표시
        - 🎨 **푸터 추가**: 모든 페이지 하단에 개발자 정보 표시
        - 📝 **도움말 전면 개편**: 친절하고 상세한 설명으로 업데이트
        
        ---
        
        #### v4.8 (2026-01-14) - 미분류 목록 페이징
        
        - 📂 **미분류 명단 페이징**: 30개씩 나누어 보기
        - ✨ **상세 도움말 복구**: 최신 기능 반영
        
        ---
        
        #### v4.6 - 구조 개선
        
        - 🔧 검색 성능 최적화 및 코드 구조 개선
        - 🎨 UI 스타일 분리
        
        ---
        
        #### v4.0 - 첫 정식 배포
        
        - ✅ 설교 원고 통합 검색
        - ✅ 연대기 기능
        - ✅ 성경별 통계 및 히트맵
        - ✅ 워드 클라우드
        - ✅ 엑셀 내보내기
        """, unsafe_allow_html=True)
